<html>
	<head>
		<title>AR simplest example</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body, html {
				padding: 0;
				margin: 0;
				width: 100%;
				height: 100%;
				-webkit-user-select: none;
				user-select: none;
			}
			#target {
				width: 100%;
				height: 100%;
				position: absolute;
			}
			.common-message {
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				font-size: 20px;
			}
		</style>
		<link rel="stylesheet" href="../common.css"/>
		<script src="../libs/three.min.js"></script>
		<script src="../models/TeapotBufferGeometry.js"></script>
		<script type="module" src="../../polyfill/XRPolyfill.js"></script>
		<script nomodule src="../../dist/webxr-polyfill.js"></script>
		<script src="../common.js"></script>
		<script type="text/javascript" src="https://static.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
    	<script type="text/javascript" src="https://static.robotwebtools.org/roslibjs/current/roslib.min.js"></script>
		
	</head>
	<body>
		<div id="target" />

		<div onclick="hideMe(this)" id="description">
			<h2>Simplest AR</h2>
			<h5>(click to dismiss)</h5>
			<p id="text" > This example displays a box relative to the pose of a TurtleBot </p>
		</div>
		<script>

			/*
			ARSimplestExample shows how to populate the content scene 
			*/

			var x_pos = 2;

			class ARSimplestExample extends XRExampleBase {


				constructor(domElement){
					super(domElement, false)

				}



				/*// Called during construction to allow the app to populate the THREE.Scene
				initializeScene(){

					// Add a box 
					const box = new THREE.Mesh(
						new THREE.BoxBufferGeometry(1.2, 1.2, 1.2),
						new THREE.MeshPhongMaterial({ color: '#fff42d' })
					)
					box.position.set(x_position, 0.5, 2)
					this.floorGroup.add(box)

					// Add some lights to the scene
					this.scene.add(new THREE.AmbientLight('#FFF', 2))
					const directionalLight = new THREE.DirectionalLight('#FFF', 0.6)
					directionalLight.position.set(0, 10, 0)
					this.scene.add(directionalLight)
				}*/

				initializeScene(){

					document.getElementById("text").innerHTML = "Initializing the scene.." ;
					const box = new THREE.Mesh(
						new THREE.BoxBufferGeometry(1, 1, 1),
						new THREE.MeshPhongMaterial({ color: '#fff42d' })
					)
					box.position.set(x_pos, 2, 2)
					this.floorGroup.add(box)

					// Add some lights to the scene
					this.scene.add(new THREE.AmbientLight('#FFF', 1.4))
					const directionalLight = new THREE.DirectionalLight('#FFF', 0.6)
					directionalLight.position.set(0, 10, 0)
					this.scene.add(directionalLight)

				}

				set set_the_pose(x_pos)
				{
					this.x_position = x_pos;
				}
				
				// Called once per frame
				updateScene(frame){
		
					document.getElementById("text").innerHTML = "This is the x_pos... " + this.x_position ; 
					const box = new THREE.Mesh(
						new THREE.BoxBufferGeometry(0.5, 0.5, 0.5),
						new THREE.MeshPhongMaterial({ color: '#ff14d3' })
					)
					box.position.set(this.x_position, 0, 3)
					//document.getElementById("text").innerHTML = "This is the x position " + x_pos ;
					this.floorGroup.add(box)
					
				}
			}

			window.addEventListener('DOMContentLoaded', () => {
				setTimeout(() => {
					try {
						window.pageApp = new ARSimplestExample(document.getElementById('target')
							) 

						console.log('from the list...');
       					console.log(newList[0]); 
       					document.getElementById('target').x_position = newList[0];
       					console.log('from x_position...');
						console.log(document.getElementById('target').x_position );
						
					} catch(e) {
						console.error('page error', e)
					}
				}, 1000)
			})

			// Connect to ROS 

			var newList = [];

					var ros = new ROSLIB.Ros({
       					url : 'ws://10.0.0.104:9090'
    				 });
   
   
     				ros.on('connection', function() {
       					console.log('Connected to websocket server.');

       					var tfClient = new ROSLIB.TFClient({
       					ros : ros,
       					fixedFrame : 'world',
       					angularThres : 0.01,
       					transThres : 0.01
     					});

       					

       					tfClient.subscribe('turtle1', function(tf) {
       					//console.log(tf);
       					console.log(tf.translation.x);
       					newList.push(tf.translation.x);
       			
       					
       
    				 }); 
       				



     				});
   
     				ros.on('error', function(error) {
       					console.log('Error connecting to websocket server: ', error);
     				});
   
     				ros.on('close', function() {
       					console.log('Connection to websocket server closed.');
     				});
		</script>
	</body>
</html>
